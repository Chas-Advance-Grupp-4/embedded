name: Embedded CI Pipeline

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
    workflow_dispatch:

jobs:
    controlunit-build:
        name: controlunit (ESP-IDF)
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: controlunit
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up ESP-IDF environment
              uses: espressif/setup-idf@latest
              with:
                  esp_idf_version: v5.5.1

            - name: Echo from controlunit
              run: echo "Building controlunit with ESP-IDF for ESP32-S3-Zero"

    sensorunit-build:
        name: sensorunit (PlatformIO Arduino)
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: sensorunit
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up PlatformIO
              uses: platformio/action-core@latest

            - name: Echo from sensorunit
              run: echo "Building sensorunit with PlatformIO for Arduino UNO R4 Wifi"
